"use client";

import { useEffect, useRef } from "react";
import { gsap } from "gsap";

export default function Signature() {
  const signatureRef = useRef(null);
  const hasAnimated = useRef(false);

  useEffect(() => {
    if (!signatureRef.current) return;

    const path1 = signatureRef.current.querySelector('[id="0001"]');
    const path2 = signatureRef.current.querySelector('[id="0002"]');

    if (!path1 || !path2) return;

    // Calculate path lengths
    const length1 = path1.getTotalLength();
    const length2 = path2.getTotalLength();

    // Set up initial state
    gsap.set([path1, path2], {
      strokeDasharray: (i, target) => {
        const length = target.getTotalLength();
        return `${length} ${length}`;
      },
      strokeDashoffset: (i, target) => target.getTotalLength(),
      stroke: "#000",
      strokeWidth: 12,
      fill: "none",
    });

    // Create intersection observer
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting && !hasAnimated.current) {
            hasAnimated.current = true;

            // Animate path 0001 first
            gsap.to(path1, {
              strokeDashoffset: 0,
              duration: 1,
              ease: "power2.inOut",
              onComplete: () => {
                // Fill path 0001 and hide stroke instantly
                gsap.set(path1, {
                  fill: "#000",
                  stroke: "none",
                });

                // Then animate path 0002
                gsap.to(path2, {
                  strokeDashoffset: 0,
                  duration: 1.4,
                  ease: "power2.inOut",
                  onComplete: () => {
                    // Fill path 0002 and hide stroke instantly
                    gsap.set(path2, {
                      fill: "#000",
                      stroke: "none",
                    });
                  },
                });
              },
            });
          }
        });
      },
      { threshold: 0.5 }
    );

    observer.observe(signatureRef.current);

    return () => {
      observer.disconnect();
    };
  }, []);

  return (
    <svg
      ref={signatureRef}
      viewBox="0 0 3078 2680"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      className="w-full h-auto"
    >
      <g id="Group 1">
        <path
          id="0001"
          d="M332.038 1397.54C331.048 1400.18 331.145 1403.1 332.307 1405.66C333.47 1408.22 335.603 1410.22 338.237 1411.21C340.871 1412.2 343.79 1412.1 346.352 1410.94C348.915 1409.78 350.91 1407.64 351.9 1405.01C351.9 1405.01 351.9 1405.01 351.9 1405.01C376.687 1338.88 401.802 1272.96 427.758 1207.34C456.623 1134.25 486.196 1061.44 516.118 988.586C516.164 988.473 516.211 988.359 516.257 988.246C619.968 736.657 725.674 485.507 833.624 235.706C833.757 235.399 833.891 235.092 834.024 234.785C864.779 161.313 906.532 73.2 928.583 16.9463C927.788 16.5045 927.165 15.9068 926.859 15.5404C926.236 14.7815 926.182 14.4881 926.141 14.4183C926.118 14.3544 926.172 14.5125 926.217 14.7308C926.321 15.2175 926.416 15.9885 926.468 16.8237C926.576 18.5301 926.542 20.5387 926.429 22.5951C926.199 26.6692 925.675 30.9936 925.037 35.3076C923.746 43.9432 921.975 52.7113 920.055 61.4028C916.182 78.8393 911.635 96.2255 907.098 113.661C906.93 114.304 906.761 114.951 906.592 115.599C875.627 228.485 843.213 342.257 815.112 456.465C814.972 457.029 814.831 457.594 814.691 458.16C741.017 754.234 677.645 1052.83 625.533 1353.6C625.473 1353.95 625.413 1354.3 625.353 1354.64C565.188 1704.46 519.325 2056.57 474.972 2408.24C474.963 2408.32 474.953 2408.4 474.943 2408.47C472.154 2430.52 469.646 2452.37 467.294 2474.25C459.309 2544.48 455.288 2615.1 444.472 2684.85C459.335 2615.72 470.053 2545.88 481.345 2476.1C484.729 2454.35 487.94 2432.59 490.923 2410.57C490.934 2410.49 490.944 2410.41 490.954 2410.34C538.409 2059.11 587.852 1707.72 648.819 1358.74C648.88 1358.39 648.941 1358.04 649.002 1357.7C701.799 1057.65 765.608 759.769 839.146 464.242C839.287 463.677 839.427 463.113 839.567 462.55C867.64 348.367 897.5 235.039 927.23 120.838C927.393 120.178 927.554 119.521 927.714 118.866C932.042 101.119 935.832 83.2649 939.044 65.175C940.634 56.1427 942.099 47.0151 943.203 37.7151C943.748 33.0495 944.214 28.3318 944.407 23.4186C944.498 20.9132 944.53 18.3823 944.331 15.578C944.223 14.172 944.078 12.7381 943.693 10.9392C943.219 9.19554 943.03 7.20905 940.458 3.94061C939.79 3.14169 938.653 2.09024 937.36 1.37479C934.451 -0.449346 930.036 -0.188294 928.175 0.611602C926.973 1.04026 926.306 1.41418 925.591 1.84001C925.248 2.04824 924.898 2.28259 924.614 2.48571C924.362 2.666 924.119 2.85022 923.883 3.03789C921.929 4.63006 920.905 5.86487 919.834 7.13797C917.821 9.598 916.156 12.1027 914.718 14.3469C911.721 19.0645 909.145 23.6583 906.596 28.3303C901.54 37.6465 896.83 47.0098 892.212 56.3506C882.987 75.067 874.108 93.8858 865.368 112.644C847.879 150.252 830.864 187.971 814.246 226.196C814.112 226.503 813.979 226.81 813.846 227.118C705.786 477.175 600.417 728.408 496.63 980.183C496.583 980.296 496.537 980.409 496.49 980.523C466.545 1053.43 436.94 1126.32 408.022 1199.54C382.022 1265.28 356.825 1331.42 332.038 1397.54Z"
          fill="black"
        />
        <path
          id="0002"
          d="M381.158 1293.87C379.955 1292.35 378.197 1291.37 376.271 1291.14C374.344 1290.92 372.407 1291.47 370.885 1292.67C369.363 1293.87 368.381 1295.63 368.155 1297.56C367.929 1299.48 368.478 1301.42 369.681 1302.94C369.681 1302.94 369.681 1302.94 369.681 1302.94C379.175 1314.86 388.499 1327.12 400.189 1338.29C400.206 1338.31 400.222 1338.33 400.239 1338.34C429.11 1356.98 455.366 1346.76 480.781 1344.2C506.259 1339.89 531.147 1334.06 556.029 1328.06C556.456 1327.96 556.884 1327.86 557.311 1327.76C610.796 1314.46 665.872 1331.03 715.368 1355.13C715.906 1355.39 716.446 1355.65 716.987 1355.9C718.922 1356.82 720.868 1357.76 722.798 1358.68C781.621 1387.26 840.726 1417.38 903.356 1439.4C904.047 1439.65 904.74 1439.89 905.435 1440.12C978.646 1462.83 1051.79 1440.16 1119.94 1422.01C1120.87 1421.75 1121.79 1421.48 1122.71 1421.22C1176.68 1406.52 1224.45 1371.47 1259.8 1329.57C1260.55 1328.73 1261.31 1327.85 1262.05 1326.98C1288.16 1295.11 1306.82 1259.65 1323.35 1223.11C1323.82 1222.05 1324.29 1220.98 1324.75 1219.91C1354.38 1148.43 1354.16 1073.21 1361.09 999.849C1361.18 998.694 1361.26 997.531 1361.35 996.362C1373.8 818.243 1381.32 640.028 1393.59 462.453C1393.68 461.091 1393.78 459.737 1393.88 458.391C1399.76 385.209 1405.61 309.286 1421.44 240.99C1421.37 241.229 1421.26 241.621 1420.92 242.365C1420.84 242.551 1420.74 242.762 1420.61 243C1420.55 243.12 1420.48 243.247 1420.4 243.381C1420.38 243.416 1420.36 243.444 1420.33 243.489C1420.29 243.558 1420.25 243.629 1420.2 243.702C1420.11 243.848 1420.01 244.002 1419.9 244.166C1419 245.375 1417.39 247.747 1413.03 249.261C1410.95 249.964 1408.1 250.136 1405.73 249.526C1403.35 248.944 1401.62 247.852 1400.47 246.92C1399.3 245.971 1398.63 245.141 1398.15 244.485C1398.09 244.407 1398.02 244.307 1397.99 244.259C1397.96 244.22 1397.93 244.182 1397.91 244.144C1397.86 244.068 1397.81 243.994 1397.76 243.923C1397.67 243.78 1397.58 243.646 1397.51 243.52C1396.92 242.515 1396.74 241.986 1396.61 241.649C1396.44 241.172 1396.45 241.143 1396.46 241.19C1396.47 241.256 1396.5 241.382 1396.53 241.58C1400.94 297.081 1396.26 359.713 1390.97 418.919C1390.6 422.848 1390.18 426.85 1389.75 430.808C1379.64 517.901 1359 604.334 1337.74 690.191C1336.74 694.183 1335.73 698.17 1334.71 702.159C1311.87 791.388 1283.98 879.523 1250.85 965.374C1249.33 969.314 1247.81 973.184 1246.26 977.097C1221.28 1040.52 1192.4 1101.99 1157.45 1160.16C1155.27 1163.8 1153.09 1167.42 1150.88 1171.02C1119.2 1222.79 1083.24 1271.79 1042.71 1316.74C1039.85 1319.92 1036.97 1323.06 1034.07 1326.19C984.074 1380.99 923.61 1424.61 859.176 1462.94C855.494 1465.14 851.642 1467.41 847.922 1469.59C744.471 1529.35 636.131 1582.43 526.261 1630.75C522.065 1632.57 518.019 1634.32 513.828 1636.12C433.585 1670.9 351.398 1700.68 267.459 1726.25C263.069 1727.6 258.659 1728.96 254.258 1730.31C185.866 1751.23 116.904 1770.56 48.2427 1790.25C43.7146 1791.55 39.2435 1792.82 34.7807 1794.09C30.0242 1795.43 25.2314 1796.78 20.519 1798.05C18.1537 1798.69 15.8434 1799.3 13.5597 1799.85C12.4194 1800.12 11.2925 1800.38 10.4098 1800.54C10.175 1800.59 10.0113 1800.61 9.87039 1800.63C9.7975 1800.65 9.75504 1800.65 9.75527 1800.65C9.76416 1800.65 9.76522 1800.65 9.9853 1800.64C10.0913 1800.64 10.24 1800.64 10.4603 1800.65C10.7178 1800.67 10.8092 1800.62 11.8822 1800.84C12.3745 1800.95 13.016 1801.12 13.8904 1801.54C14.3263 1801.75 14.8214 1802.03 15.3598 1802.43C15.6287 1802.63 15.9078 1802.85 16.1899 1803.12C16.2986 1803.22 16.5527 1803.46 16.7679 1803.7C16.9885 1803.95 17.2061 1804.22 17.4152 1804.51C19.2429 1806.83 19.5264 1810.64 18.8755 1812.55C18.6149 1813.53 18.1688 1814.39 17.9736 1814.72C17.8184 1815 17.6694 1815.23 17.5297 1815.42C16.4195 1816.93 15.8987 1817.14 15.8218 1817.23C15.6581 1817.36 15.591 1817.4 15.5809 1817.41C21.8098 1814.07 32.5027 1809.75 41.3031 1806.08C42.1016 1805.76 42.9182 1805.42 43.7528 1805.08C151.022 1761.49 261.645 1725.38 372.208 1689.75C372.946 1689.51 373.685 1689.28 374.426 1689.04C581.257 1623.26 790.066 1562.39 998.675 1502.45C999.225 1502.29 999.774 1502.14 1000.32 1501.98C1158.85 1453.21 1320.9 1427.56 1485.46 1405.85C1485.94 1405.79 1486.41 1405.73 1486.89 1405.66C1811.71 1362.15 2137.52 1319.91 2463.18 1282.99C2463.37 1282.97 2463.55 1282.95 2463.73 1282.92C2544.01 1274.02 2623.65 1265.13 2703.81 1257.59C2769.48 1251.43 2835.28 1246.28 2901.15 1244.39C2901.2 1244.39 2901.25 1244.38 2901.3 1244.38C2936.83 1243.33 2972.33 1240.75 3007.6 1242.36C3007.62 1242.36 3007.64 1242.36 3007.67 1242.36C3031.47 1243.43 3055.3 1245.27 3079.17 1247.08C3080.56 1247.19 3081.93 1246.74 3082.99 1245.83C3084.05 1244.92 3084.7 1243.63 3084.81 1242.24C3084.91 1240.85 3084.46 1239.47 3083.56 1238.42C3082.65 1237.36 3081.36 1236.7 3079.97 1236.6C3079.97 1236.6 3079.97 1236.6 3079.97 1236.6C3056.09 1234.79 3032.17 1232.94 3008.13 1231.86C3008.11 1231.86 3008.09 1231.86 3008.07 1231.86C2972.29 1230.22 2936.61 1229.61 2901 1229.8C2900.95 1229.8 2900.9 1229.8 2900.85 1229.8C2834.65 1230.1 2768.22 1233.39 2702.22 1237.85C2621.6 1243.33 2541.62 1250.44 2461.14 1258.71C2460.95 1258.73 2460.77 1258.75 2460.59 1258.77C2134.2 1293.12 1808.03 1331.89 1482.78 1375.44C1482.31 1375.5 1481.83 1375.57 1481.36 1375.63C1317.37 1397.2 1150.91 1423.71 991.995 1472.8C991.446 1472.96 990.895 1473.12 990.344 1473.27C781.285 1533.51 573.718 1598.52 367.155 1666.78C366.415 1667.02 365.676 1667.27 364.939 1667.51C254.453 1704.49 144.617 1743.45 36.5121 1787.42C35.6708 1787.77 34.8471 1788.11 34.0409 1788.44C24.5027 1792.51 16.4744 1795.21 5.1765 1801.25C4.86273 1801.45 4.53641 1801.67 4.15766 1801.96C3.93125 1802.16 2.99563 1802.73 1.77881 1804.4C1.62165 1804.63 1.45712 1804.88 1.28844 1805.18C1.07496 1805.54 0.600871 1806.46 0.330088 1807.48C-0.344554 1809.48 -0.0501795 1813.36 1.82284 1815.75C2.03761 1816.05 2.2614 1816.32 2.4887 1816.58C2.71041 1816.82 2.97305 1817.08 3.08549 1817.18C3.37738 1817.46 3.66711 1817.69 3.94761 1817.9C4.509 1818.31 5.03069 1818.61 5.49662 1818.83C6.43106 1819.28 7.14663 1819.48 7.72683 1819.61C8.01714 1819.67 8.2742 1819.72 8.50774 1819.75C8.62441 1819.77 8.73525 1819.78 8.84093 1819.79C8.947 1819.81 8.96748 1819.81 9.02872 1819.81C9.24212 1819.83 9.43506 1819.85 9.61363 1819.85C9.97039 1819.87 10.2714 1819.87 10.5456 1819.86C12.3692 1819.78 12.969 1819.62 13.8298 1819.48C15.3726 1819.2 16.6686 1818.91 17.9995 1818.6C20.6112 1817.98 23.0246 1817.36 25.4933 1816.71C30.39 1815.42 35.2436 1814.07 40.0504 1812.71C44.5567 1811.43 49.0485 1810.14 53.5883 1808.82C122.358 1788.77 190.583 1766.96 259.07 1746.01C263.476 1744.66 267.894 1743.31 272.294 1741.96C356.382 1716.65 440.526 1689.26 522.047 1655.8C526.305 1654.07 530.417 1652.39 534.68 1650.64C646.325 1604.23 756.52 1554.5 862.569 1494.98C866.389 1492.81 870.348 1490.53 874.139 1488.33C940.198 1450.13 1004.38 1404.6 1056.84 1347.39C1059.86 1344.15 1062.85 1340.9 1065.82 1337.62C1107.85 1291.26 1145.04 1240.63 1177.67 1187.47C1179.95 1183.76 1182.2 1180.05 1184.44 1176.32C1220.43 1116.63 1250.35 1053.26 1275.75 988.754C1277.33 984.771 1278.87 980.834 1280.42 976.828C1314.07 889.601 1342.26 800.502 1365.44 709.994C1366.47 705.948 1367.49 701.903 1368.49 697.85C1389.73 611.111 1408.25 523.579 1417.96 433.812C1418.38 429.721 1418.78 425.578 1419.14 421.501C1423.92 360.25 1429.38 301.806 1423.39 236.549C1423.29 236.004 1423.2 235.584 1423.04 234.917C1422.85 234.154 1422.7 233.535 1422.31 232.421C1422.03 231.67 1421.7 230.81 1420.97 229.556C1420.87 229.399 1420.77 229.235 1420.66 229.064C1420.6 228.978 1420.54 228.891 1420.48 228.801C1420.45 228.757 1420.42 228.711 1420.39 228.666C1420.35 228.61 1420.27 228.493 1420.2 228.403C1419.65 227.646 1418.9 226.736 1417.67 225.727C1415.6 223.653 1409.12 221.52 1404.67 223.279C1400.17 224.837 1398.43 227.327 1397.4 228.729C1397.27 228.916 1397.15 229.096 1397.04 229.269C1396.99 229.355 1396.94 229.44 1396.89 229.523C1396.86 229.577 1396.84 229.609 1396.81 229.652C1396.72 229.815 1396.63 229.971 1396.55 230.122C1396.39 230.422 1396.26 230.699 1396.14 230.957C1395.67 231.985 1395.43 232.738 1395.23 233.414C1378.54 309.622 1378.12 382.605 1372.44 456.924C1372.35 458.275 1372.26 459.634 1372.17 461.001C1360.94 639.07 1353.98 817.314 1342.35 995.026C1342.27 996.191 1342.19 997.349 1342.11 998.501C1335.72 1071.41 1335.31 1147.06 1308.12 1212.8C1307.69 1213.82 1307.25 1214.83 1306.81 1215.85C1291.11 1251.29 1273.18 1286.78 1249.39 1316.33C1248.73 1317.13 1248.05 1317.92 1247.39 1318.69C1213.13 1359.91 1169.86 1392.51 1118.47 1406.71C1117.59 1406.96 1116.72 1407.22 1115.83 1407.47C1048.34 1425.72 975.967 1445.18 910.804 1424.31C910.183 1424.1 909.564 1423.88 908.947 1423.66C847.594 1401.93 789.419 1372.18 730.156 1343.37C728.209 1342.43 726.242 1341.49 724.285 1340.56C723.738 1340.3 723.191 1340.04 722.646 1339.78C671.813 1315.01 611.363 1299.58 554.076 1313.99C553.617 1314.1 553.159 1314.21 552.7 1314.32C505.192 1324.06 447.275 1344.33 410.239 1327.67C410.232 1327.66 410.225 1327.65 410.217 1327.65C399.864 1317.78 390.598 1305.76 381.158 1293.87Z"
          fill="black"
        />
      </g>
    </svg>
  );
}
